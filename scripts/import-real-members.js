const { PrismaClient } = require('@prisma/client');
const bcrypt = require('bcrypt');

const prisma = new PrismaClient();

// 실제 크롤링한 데이터
const pastorData = [[1, '김종내', '서광', '원로'], [2, '박승규', '선한', '원로'], [3, '박영언', '안양동성', '원로'], [4, '배인수', '-', '은퇴'], [5, '김명묵', '삼흥', '위임'], [6, '안종민', '혜광', '무임'], [7, '최영도', '새능력', '시무'], [8, '우기종', '덕원', '위임'], [9, '김구', '서광', '위임'], [10, '김종수', '조은', '위임'], [11, '나종춘', '대유평', '위임'], [12, '정택정', '-', '선교사'], [13, '양남의', '베데스다', '시무'], [14, '남명철', '창세', '위임'], [15, '채정수', '생동', '위임'], [16, '김용희', '-', '은퇴'], [17, '김웅기', '-', '무임'], [18, '정영교', '산본양문', '위임'], [19, '이흥근', '행복한', '위임'], [20, '나영수', '부림', '시무'], [21, '오준철', '진리와사랑', '위임'], [22, '강명호', '함께가는', '위임'], [23, '임평환', '-', '선교사'], [24, '이걸주', '바울', '은퇴'], [25, '이덕재', '안산선한', '시무'], [26, '황승철', '은혜', '시무'], [27, '정규천', '평안', '위임'], [28, '조충휘', '시화서부', '위임'], [29, '조용구', '새희망', '시무'], [30, '김호철', '시흥은향', '위임'], [31, '김영임', '큰숲나무', '시무'], [32, '이광현', '큰빛', '시무'], [33, '박혜영', '산오름', '위임'], [34, '유병돈', '하늘문', '위임'], [35, '김기석', '새소망', '시무'], [36, '정보광', '-', '무임'], [37, '박종권', '수원양문', '시무'], [38, '김영회', '봉담언약', '시무'], [39, '이성욱', '-', '선교사'], [40, '문진형', '서광(유학)', '부목'], [41, '박수규', '사랑의', '시무'], [42, '문보길', '안산샘물', '시무'], [43, '김인용', '호계동산', '시무'], [44, '박종경', '선한', '위임'], [45, '최대복', '-', '무임'], [46, '이지훈', '-', '선교사'], [47, '김동섭', '창세', '부목'], [48, '김용필', '짚풀', '무임'], [49, '안문기', '산오름', '부목'], [50, '김동구', '산오름', '부목'], [51, '한경우', '창세', '선교사'], [52, '김준', '산본양문', '부목'], [53, '손윤섭', '행복한', '부목'], [54, '배종원', '-', '부목'], [55, '하귀열', '서광', '선교사'], [56, '김신우', '산본양문', '부목'], [57, '유병구', '사랑하는', '편목'], [58, '이원희', '복지중앙', '시무'], [59, '노진경', '한길', '위임'], [60, '곽성열', '지명', '시무'], [61, '하성봉', '평안', '부목'], [62, '최본우', '혜성', '시무'], [63, '김완철', '산본양문', '부목'], [64, '박은진', '갈보리', '시무'], [65, '이성령', '덕원', '부목'], [66, '강경림', '창세', '부목'], [67, '김상욱', '서광', '부목'], [68, '이상성', '주영광', '사무'], [69, '김형석', '예안', '시무'], [70, '김대광', '새순', '위임'], [71, '이규봉', '안디옥', '위임'], [72, '정성수', '산본양문', '부목'], [73, '강치현', '함께가는', '부목'], [74, '장요한', '사가임마누엘', '위임'], [75, '김재철', '강남임마누엘', '위임'], [76, '이광희', '행복한', '부목'], [77, '박우동', '행복한', '부목'], [78, '최영애', '신안', '전도사'], [79, '마훈희', '사랑하는', '부목'], [80, '노성한', '산본양문', '부목'], [81, '정민영', '산본양문', '부목'], [82, '이중원', '예안', '부목']];

const elderData = [[1, '김재득', '평안'], [16, '최근철', '산본양문'], [2, '김명수', '서광'], [17, '박종욱', '함께가는'], [3, '이주영', '생동'], [18, '유충종', '하늘문'], [4, '이달근', '행복한'], [19, '조두휘', '시화서부'], [5, '임광열', '등대'], [20, '박정효', '진리와사랑'], [6, '김임준', '한길'], [21, '유진우', '대유평'], [7, '이종호', '창세'], [22, '한유식', '산오름'], [8, '이영화', '조은'], [23, '이상훈', '샬롬'], [9, '박태섭', '삼흥'], [24, '박석순', '은향'], [10, '박형근', '안양동성'], [25, '이정열', '갈보리'], [11, '김혁관', '선한'], [26, '홍윤구', '연합'], [12, '이동기', '덕원'], [27, '정송현', '분당새순'], [13, '김현수', '사랑하는'], [28, '조기래', '사가정임마누엘'], [14, '윤봉호', '산본양문'], [29, '김호중', '강남임마누엘'], [15, '정현진', '산본양문']];

async function importRealMembers() {
    try {
        const hashedPassword = await bcrypt.hash('presbytery2024', 10);

        // 기존 테스트 데이터 삭제 (pastor, elder만)
        await prisma.user.deleteMany({
            where: {
                role: {
                    in: ['pastor', 'elder']
                }
            }
        });

        console.log('✅ 기존 테스트 데이터 삭제 완료');

        // 목사회원 데이터 추가
        let pastorCount = 0;
        for (const pastor of pastorData) {
            const [number, name, churchName, position] = pastor;

            // churchName이 '-'인 경우 처리
            const finalChurchName = churchName === '-' ? '미정' : churchName;

            // username 생성 (pastor_ + 번호)
            const username = `pastor_${number}`;

            // 연락처는 실제 데이터에 없으므로 기본값 설정
            const phone = '010-0000-0000';

            await prisma.user.create({
                data: {
                    username,
                    password: hashedPassword,
                    name,
                    phone,
                    churchName: finalChurchName,
                    position,
                    role: 'pastor',
                    isApproved: true
                }
            });
            pastorCount++;
        }

        console.log(`✅ 목사회원 데이터 추가 완료: ${pastorCount}명`);

        // 장로총대 데이터 추가
        let elderCount = 0;
        for (const elder of elderData) {
            const [number, name, churchName] = elder;

            // username 생성 (elder_ + 번호)
            const username = `elder_${number}`;

            // 장로의 position은 '장로'로 통일
            const position = '장로';

            // 연락처는 실제 데이터에 없으므로 기본값 설정
            const phone = '010-0000-0000';

            await prisma.user.create({
                data: {
                    username,
                    password: hashedPassword,
                    name,
                    phone,
                    churchName,
                    position,
                    role: 'elder',
                    isApproved: true
                }
            });
            elderCount++;
        }

        console.log(`✅ 장로총대 데이터 추가 완료: ${elderCount}명`);
        console.log(`\n📊 전체 데이터 요약:`);
        console.log(`   - 목사회원: ${pastorCount}명`);
        console.log(`   - 장로총대: ${elderCount}명`);
        console.log(`   - 총 회원: ${pastorCount + elderCount}명`);

    } catch (error) {
        console.error('❌ 오류 발생:', error);
    } finally {
        await prisma.$disconnect();
    }
}

importRealMembers();
